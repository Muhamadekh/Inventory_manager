{% extends 'layout.html' %}
{% block content %}
    <!-- Buttons -->
  {% if current_user.user_role == 'Admin' %}
    <a href="{{ url_for('view_shop', shop_id = shop.id) }}" class="btn btn-secondary ml-2 mb-2">Back to Shop</a>
  {% else %}
    <div class="button-container">
      <a href="{{ url_for('view_shops')}}" class="button active">View Shops</a>
      <a href="{{ url_for('stock_sold', shop_id=shop.id)}}" class="button active">Sales</a>
      <a href="{{ url_for('view_shop', shop_id=shop.id)}}"class="button">Stock</a>
      <a href="{{ url_for('stock_received', shop_id=shop.id)}}" class="button">Receive Stock</a>
      <a href="{{ url_for('add_new_stock', shop_id=shop.id)}}" class="button">Add New Item</a>
      <a class="ml-4"><strong>Date</strong>:{{Date}}</a>
      <a class="ml-4"><strong>Shopkeeper:</strong>{{shop.shopkeeper}}</a>
      <div class="float-right"><a href="{{ url_for('daily_count', shop_id=shop.id)}}" class="btn btn-outline-info">Send Daily Count</a></div>
    </div>
  {% endif %}


  <!-- Table-like form for adding new sale -->
  <table class="table">
    <thead>
      <tr>
        <th>Item Name</th>
        <th>Quantity</th>
        <th>Discount</th>
        <th>Payment Method</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <form method="POST">
          {{ form.hidden_tag() }}
          <td>{{ form.item_name(class="form-control") }}</td>
          <td>{{ form.item_quantity(class="form-control") }}</td>
          <td>{{ form.item_discount(class="form-control") }}</td>
          <td>{{ form.payment_method(class="form-control") }}</td>
          <td>{{ form.submit(class="form-control btn btn-primary") }}</td>
        </form>
      </tr>
    </tbody>
  </table>

  <!-- Sales Log -->
  {% if not sales_lookup %}
    <div class="text-center mt-4"><h5 class="font-italic">There are no sales for this shop yet.</h5></div>
  {% else %}
    {% for date in sales_dates %}
      {% if current_user.user_role != 'Admin'%}
        <div class="table" id="SalesTable">
      {% else %}
        <div class="table">
      {% endif %}
          <table class="table mt-4">
            <thead>
            <caption style="caption-side: top; text-align: center"><span><strong>{{date}}</strong></span></caption>
              <tr>
                <th>Item Name</th>
                <th>Quantity Sold</th>
                <th>Discount Given</th>
                <th>Sales Value</th>
                <th>Payment Method</th>
                <th colspan="2">Time Sold</th>
              </tr>
            </thead>
            <tbody>
              {% for entry in sales_lookup[date] %}
                <tr>
                  <td>{{ entry.item_name }}</td>
                  <td>{{ "{:,}".format (entry.item_quantity) }}</td>
                  <td>{{ "{:,}".format( entry.item_discount )}}</td>
                  <td>{{ "{:,}".format (entry.item_value) }}</td>
                  <td>{{ entry.payment_method }}</td>
                  <td>{{ entry.date_sold.strftime('%H:%M:%S') }}</td>
                  {% if current_user.user_role == 'Admin'%}
                  <td><a href="{{ url_for('edit_stock_sold', stock_sold_id=entry.id) }}">Edit</a></td>
                  {% endif %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
      </div>
    {% endfor %}
  {% endif %}
{% endblock %}